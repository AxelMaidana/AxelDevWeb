---
import { Image } from "astro:assets";
import type { Project } from "../../data/projects";

interface Props {
    project: Project;
    className?: string;
    isWide?: boolean;
}

const { project, className = "" } = Astro.props;
---

<a
    href={`/project/${project.id}`}
    class={`group block relative cursor-pointer rounded-[24px] bg-surface border border-white/5 p-4 sm:p-5 lg:p-0 lg:h-[400px] xl:h-[460px] lg:overflow-hidden transition-all duration-500 hover:shadow-premium hover:-translate-y-1 hover:border-white/10 ${className}`}
>
    <!-- Media Area Box -->
    <div
        class="relative rounded-[16px] bg-[#0A0A0A] overflow-hidden mb-5 sm:mb-6 aspect-[2/1] lg:absolute lg:inset-0 lg:w-full lg:h-full lg:mb-0 lg:aspect-auto lg:rounded-none shrink-0"
    >
        <Image
            src={project.image}
            alt={project.title}
            width={800}
            height={600}
            decoding="async"
            class="absolute inset-0 w-full h-full object-cover transition-all duration-700 opacity-80 lg:opacity-100 lg:group-hover:scale-105"
            transition:name={`project-media-${project.id}`}
        />

        {
            project.videoCover && (
                <video
                    src={project.videoCover}
                    muted
                    loop
                    playsinline
                    class="absolute inset-0 w-full h-full object-cover opacity-0 lg:group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"
                    data-hover-video
                />
            )
        }

        <!-- Subtle gradient overlay -->
        <div
            class="absolute inset-0 bg-gradient-to-t from-background/80 via-transparent to-transparent opacity-60 transition-opacity duration-500 lg:opacity-30"
        >
        </div>

        <!-- Mobile Premium Glass Button -->
        <div
            class="lg:hidden absolute bottom-4 right-4 bg-surface/40 backdrop-blur-md border border-white/10 w-10 h-10 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-500 translate-y-4 group-hover:translate-y-0 shadow-lg"
        >
            <iconify-icon
                icon="solar:arrow-right-up-linear"
                class="text-primary text-xl"></iconify-icon>
        </div>
    </div>

    <!-- Content Area -->
    <div
        class="flex flex-col justify-between items-start px-1 pb-1 lg:absolute lg:bottom-0 lg:left-0 lg:right-0 lg:z-10 lg:p-6 lg:bg-background/80 lg:backdrop-blur-xl lg:border-t-0 lg:opacity-0 lg:group-hover:opacity-95 lg:transition-all lg:duration-500"
    >
        <div
            class="w-full pr-2 lg:pr-16 lg:transform lg:translate-y-3 lg:group-hover:translate-y-0 lg:transition-transform lg:duration-500 lg:ease-out text-left"
        >
            <h3
                class="text-xl sm:text-2xl lg:text-2xl font-semibold tracking-tight text-primary mb-2 transition-colors lg:mb-2"
                transition:name={`project-title-${project.id}`}
            >
                {project.title}
            </h3>
            <p
                class="text-sm lg:text-sm text-secondary font-normal leading-relaxed mb-6 line-clamp-2 lg:mb-4 lg:max-w-xl"
            >
                {project.shortDescription}
            </p>
        </div>

        <!-- Technology badges -->
        <div
            class="flex flex-wrap gap-2 shrink-0 lg:transform lg:translate-y-3 lg:group-hover:translate-y-0 lg:transition-transform lg:duration-500 lg:delay-75 lg:ease-out"
        >
            {
                project.technologies
                    .slice(0, 4)
                    .map((tech) => (
                        <span class="text-[10px] lg:text-[11px] font-medium border border-white/5 bg-white/5 lg:bg-white/10 backdrop-blur-md px-2.5 lg:px-2.5 py-1 lg:py-1 rounded-full text-secondary lg:text-primary tracking-wide">
                            {tech}
                        </span>
                    ))
            }
            {
                project.technologies.length > 4 && (
                    <span class="text-[10px] lg:text-[11px] font-medium border border-white/5 bg-white/5 lg:bg-white/10 backdrop-blur-md px-2.5 lg:px-2.5 py-1 lg:py-1 rounded-full text-secondary lg:text-primary tracking-wide">
                        +{project.technologies.length - 4}
                    </span>
                )
            }
        </div>

        <!-- Desktop Premium Glass Button overlay -->
        <div
            class="hidden lg:flex absolute top-6 right-6 bg-surface/50 backdrop-blur-md border border-white/10 w-10 h-10 rounded-full items-center justify-center transition-all duration-500 transform lg:translate-y-3 lg:group-hover:translate-y-0 shadow-xl group-hover:bg-primary group-hover:text-background text-primary"
        >
            <iconify-icon icon="solar:arrow-right-up-linear" class="text-xl"
            ></iconify-icon>
        </div>
    </div>

    <script>
        function setupHoverVideos() {
            const videos = document.querySelectorAll<HTMLVideoElement>(
                "video[data-hover-video]",
            );

            videos.forEach((video) => {
                const container = video.closest(".group");
                if (!container) return;

                container.addEventListener("mouseenter", () => {
                    video
                        .play()
                        .catch((e) => console.log("Autoplay prevented", e));
                });

                container.addEventListener("mouseleave", () => {
                    video.pause();
                });
            });
        }

        document.addEventListener("astro:page-load", setupHoverVideos);
        setupHoverVideos();
    </script>
</a>
