---
import type { Project } from "../../data/projects";

interface Props {
    project: Project;
    className?: string;
}

const { project, className = "" } = Astro.props;
---

<a
    href={`/project/${project.id}`}
    class={`group block cursor-pointer ${className}`}
>
    <div
        class="relative aspect-[4/3] rounded-2xl bg-[#0A0A0A] border border-white/5 overflow-hidden mb-6 group-hover:border-indigo-500/30 transition-colors duration-500"
    >
        <img
            src={project.image}
            alt={project.title}
            class="absolute inset-0 w-full h-full object-cover transition-opacity duration-700 group-hover:opacity-0"
            transition:name={`project-media-${project.id}`}
        />

        <video
            src={project.videoCover}
            muted
            loop
            playsinline
            class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"
            data-hover-video></video>

        <div
            class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-60 group-hover:opacity-40 transition-opacity duration-500"
        >
        </div>

        <div
            class="absolute bottom-4 right-4 bg-black/50 backdrop-blur border border-white/10 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-500 translate-y-4 group-hover:translate-y-0"
        >
            <iconify-icon
                icon="solar:arrow-right-up-linear"
                class="text-white text-xl"></iconify-icon>
        </div>
    </div>

    <div class="flex justify-between items-start">
        <div>
            <h3
                class="text-xl text-white font-medium mb-1 group-hover:text-indigo-400 transition-colors"
                transition:name={`project-title-${project.id}`}
            >
                {project.title}
            </h3>
            <p class="text-sm text-slate-500 line-clamp-2 pr-4">
                {project.shortDescription}
            </p>
        </div>
        <div class="flex gap-2 shrink-0">
            {
                project.technologies
                    .slice(0, 1)
                    .map((tech) => (
                        <span class="text-[10px] font-mono border border-white/10 bg-white/5 backdrop-blur-sm px-2 py-1 rounded text-slate-400">
                            {tech}
                        </span>
                    ))
            }
            {
                project.technologies.length > 1 && (
                    <span class="text-[10px] font-mono border border-white/10 bg-white/5 backdrop-blur-sm px-2 py-1 rounded text-slate-400">
                        +{project.technologies.length - 1}
                    </span>
                )
            }
        </div>
    </div>

    <script>
        function setupHoverVideos() {
            const videos = document.querySelectorAll<HTMLVideoElement>(
                "video[data-hover-video]",
            );

            videos.forEach((video) => {
                const container = video.closest(".group");
                if (!container) return;

                container.addEventListener("mouseenter", () => {
                    video
                        .play()
                        .catch((e) => console.log("Autoplay prevented", e));
                });

                container.addEventListener("mouseleave", () => {
                    video.pause();
                });
            });
        }

        document.addEventListener("astro:page-load", setupHoverVideos);
        setupHoverVideos();
    </script>
</a>
